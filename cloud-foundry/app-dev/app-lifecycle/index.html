<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=https://laidbackware.github.io/cloud-foundry/app-dev/app-lifecycle/ rel=canonical><link href=../../../tanzu-platform/intro/ rel=prev><link href=../debugging-traffic/ rel=next><link rel=icon href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.5.42"><title>App Lifecycle Management - Matt's Hackery</title><link rel=stylesheet href=../../../assets/stylesheets/main.0253249f.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"JetBrains Mono"}</style><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-F2EF959YF2"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-F2EF959YF2",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-F2EF959YF2",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=cyan data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#application-life-cycle class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title="Matt's Hackery" class="md-header__button md-logo" aria-label="Matt's Hackery" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Matt's Hackery </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> App Lifecycle Management </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/laidbackware/laidbackware.github.io title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> laidbackware/laidbackware.github.io </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../../ci-cd/tanzu-supply-chains/supply-chain-architecture/ class=md-tabs__link> CI/CD </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../../tanzu-platform/intro/ class=md-tabs__link> Tanzu Platform </a> </li> <li class=md-tabs__item> <a href=../../../k8s/tkgs/admin-access/ class=md-tabs__link> Kubernetes </a> </li> <li class=md-tabs__item> <a href=../../../shell/bash-recipes/ class=md-tabs__link> Shell </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title="Matt's Hackery" class="md-nav__button md-logo" aria-label="Matt's Hackery" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> Matt's Hackery </label> <div class=md-nav__source> <a href=https://github.com/laidbackware/laidbackware.github.io title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> laidbackware/laidbackware.github.io </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> CI/CD </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> CI/CD </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_1> <label class=md-nav__link for=__nav_2_1 id=__nav_2_1_label tabindex=0> <span class=md-ellipsis> Tanzu Supply Chains </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_1_label aria-expanded=false> <label class=md-nav__title for=__nav_2_1> <span class="md-nav__icon md-icon"></span> Tanzu Supply Chains </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../ci-cd/tanzu-supply-chains/supply-chain-architecture/ class=md-nav__link> <span class=md-ellipsis> Supply chain architecture </span> </a> </li> <li class=md-nav__item> <a href=../../../ci-cd/tanzu-supply-chains/component-architecture/ class=md-nav__link> <span class=md-ellipsis> Component architecture </span> </a> </li> <li class=md-nav__item> <a href=../../../ci-cd/tanzu-supply-chains/hello-component/ class=md-nav__link> <span class=md-ellipsis> Hello Component </span> </a> </li> <li class=md-nav__item> <a href=../../../ci-cd/tanzu-supply-chains/component-authoring-bash/ class=md-nav__link> <span class=md-ellipsis> Component authoring </span> </a> </li> <li class=md-nav__item> <a href=../../../ci-cd/tanzu-supply-chains/private-ca-hack/ class=md-nav__link> <span class=md-ellipsis> Private CA Hack </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> Tanzu Platform </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Tanzu Platform </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../tanzu-platform/intro/ class=md-nav__link> <span class=md-ellipsis> Intro </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2 checked> <label class=md-nav__link for=__nav_3_2 id=__nav_3_2_label tabindex=0> <span class=md-ellipsis> Cloud Foundry Runtime </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_2_label aria-expanded=true> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> Cloud Foundry Runtime </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2_1 checked> <label class=md-nav__link for=__nav_3_2_1 id=__nav_3_2_1_label tabindex=0> <span class=md-ellipsis> App dev </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_2_1_label aria-expanded=true> <label class=md-nav__title for=__nav_3_2_1> <span class="md-nav__icon md-icon"></span> App dev </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> App Lifecycle Management </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> App Lifecycle Management </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#what-happens-when-an-app-starts class=md-nav__link> <span class=md-ellipsis> What happens when an app starts </span> </a> <nav class=md-nav aria-label="What happens when an app starts"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#application-health-checks class=md-nav__link> <span class=md-ellipsis> Application health checks </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#what-happens-when-an-app-crashes class=md-nav__link> <span class=md-ellipsis> What happens when an app crashes </span> </a> </li> <li class=md-nav__item> <a href=#what-happens-when-an-app-stops class=md-nav__link> <span class=md-ellipsis> What happens when an app stops </span> </a> <nav class=md-nav aria-label="What happens when an app stops"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#java-shutdown class=md-nav__link> <span class=md-ellipsis> Java shutdown </span> </a> </li> <li class=md-nav__item> <a href=#detecting-a-sigkill class=md-nav__link> <span class=md-ellipsis> Detecting a SIGKILL </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#testing-app-behaviour class=md-nav__link> <span class=md-ellipsis> Testing app behaviour </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../debugging-traffic/ class=md-nav__link> <span class=md-ellipsis> Debugging egress traffic </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2_2> <label class=md-nav__link for=__nav_3_2_2 id=__nav_3_2_2_label tabindex=0> <span class=md-ellipsis> Bosh </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2_2> <span class="md-nav__icon md-icon"></span> Bosh </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../bosh/run-pre-start-commands/ class=md-nav__link> <span class=md-ellipsis> Pre-start script with runtime-config </span> </a> </li> <li class=md-nav__item> <a href=../../bosh/relocating-vms/ class=md-nav__link> <span class=md-ellipsis> Relocate vSphere VMs into another cluster </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2_3> <label class=md-nav__link for=__nav_3_2_3 id=__nav_3_2_3_label tabindex=0> <span class=md-ellipsis> UAA </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2_3> <span class="md-nav__icon md-icon"></span> UAA </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../uaa/login/ class=md-nav__link> <span class=md-ellipsis> UAA Login with Golang CLI </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Kubernetes </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_1> <label class=md-nav__link for=__nav_4_1 id=__nav_4_1_label tabindex=0> <span class=md-ellipsis> vSphere with Tanzu (TKGS) </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_1_label aria-expanded=false> <label class=md-nav__title for=__nav_4_1> <span class="md-nav__icon md-icon"></span> vSphere with Tanzu (TKGS) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/tkgs/admin-access/ class=md-nav__link> <span class=md-ellipsis> Get full admin access </span> </a> </li> <li class=md-nav__item> <a href=../../../k8s/tkgs/set-default-psa/ class=md-nav__link> <span class=md-ellipsis> Set default PSA </span> </a> </li> <li class=md-nav__item> <a href=../../../k8s/tkgs/update-cp-disks/ class=md-nav__link> <span class=md-ellipsis> Update the control plane disks </span> </a> </li> <li class=md-nav__item> <a href=../../../k8s/tkgs/troubleshooting/ class=md-nav__link> <span class=md-ellipsis> Bootstrap Troubleshooting </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2> <label class=md-nav__link for=__nav_4_2 id=__nav_4_2_label tabindex=0> <span class=md-ellipsis> Demo Apps </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_2_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> Demo Apps </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../k8s/apps/minimal-lb/ class=md-nav__link> <span class=md-ellipsis> Minimal web app + LB </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Shell </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Shell </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../shell/bash-recipes/ class=md-nav__link> <span class=md-ellipsis> Bash recipes </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#what-happens-when-an-app-starts class=md-nav__link> <span class=md-ellipsis> What happens when an app starts </span> </a> <nav class=md-nav aria-label="What happens when an app starts"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#application-health-checks class=md-nav__link> <span class=md-ellipsis> Application health checks </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#what-happens-when-an-app-crashes class=md-nav__link> <span class=md-ellipsis> What happens when an app crashes </span> </a> </li> <li class=md-nav__item> <a href=#what-happens-when-an-app-stops class=md-nav__link> <span class=md-ellipsis> What happens when an app stops </span> </a> <nav class=md-nav aria-label="What happens when an app stops"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#java-shutdown class=md-nav__link> <span class=md-ellipsis> Java shutdown </span> </a> </li> <li class=md-nav__item> <a href=#detecting-a-sigkill class=md-nav__link> <span class=md-ellipsis> Detecting a SIGKILL </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#testing-app-behaviour class=md-nav__link> <span class=md-ellipsis> Testing app behaviour </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=application-life-cycle>Application life-cycle<a class=headerlink href=#application-life-cycle title="Permanent link">&para;</a></h1> <p>Factor 9 of the 12 factor app states that <a href=https://12factor.net/disposability>apps must be disposable</a> and start quickly. This means that apps must perform a graceful shutdown in a way that allows the hosting platform to make the action invisible to the client. Furthermore when running on a PaaS, an app instance must be able to signal to it's hosting platform it is in a healthy state and ready to take traffic.</p> <p>This doc will explain at a high level the actions which must be taken when engineering an app to run on Cloud Foundry, such that a user or client will not notice an interruption in service during app push, scale, restart and platform upgrades.</p> <h2 id=what-happens-when-an-app-starts>What happens when an app starts<a class=headerlink href=#what-happens-when-an-app-starts title="Permanent link">&para;</a></h2> <p>The start process applies to the following events:</p> <ul> <li><strong>cf push</strong> - new instance of a new version of the app are started to replace the old version</li> <li><strong>cf scale</strong> - new instance of the app are started</li> <li><strong>cf restart (rolling strategy)</strong> - all instances of the app are replaced</li> <li><strong>Platform upgrade</strong> - Diego cells follow a rolling replacement</li> </ul> <p>At a very high level the <a href=https://docs.cloudfoundry.org/devguide/deploy-apps/healthchecks.html#healthcheck-lifecycle>app start process</a> follows:</p> <ul> <li>Schedule decides a instance is needed and instructs the system to start a container</li> <li>Container starts on a Diego cell (worker)</li> <li>The Diego cell starts a <a href=https://docs.cloudfoundry.org/devguide/deploy-apps/healthchecks.html#types>health check</a> process</li> <li>Application health check passes</li> <li>The <a href=https://docs.cloudfoundry.org/concepts/cf-routing-architecture.html>Gorouter</a> is instructed to add the app into rotation</li> </ul> <h3 id=application-health-checks>Application health checks<a class=headerlink href=#application-health-checks title="Permanent link">&para;</a></h3> <p>Having a health check which only returns true when the app is ready to serve traffic is critical to ensure that adding a container does not cause a client to receive a HTTP error.</p> <p>Cloud Foundry support 3 types of <a href=https://docs.cloudfoundry.org/devguide/deploy-apps/healthchecks.html#types>health checks</a>:</p> <ul> <li><strong>http</strong> - a http request sent to a specific endpoint of the app, with 200 OK expected as the response</li> <li><strong>port</strong> - a TCP can be made on a designated port or ports. <strong>This is the default.</strong></li> <li><strong>process</strong> - the process is running. E.g the python interpreter is running</li> </ul> <p>It is recommended to use <code>http</code> as this is the only option that can ensure the app is ready for traffic. In the case of web apps, both port and process health checks will only confirm that the web server is online, but not that the underlying software is able to respond to traffic. In addition should an app become unresponsive a port health check may return even though the underlying app is no longer able to respond to a request.</p> <h2 id=what-happens-when-an-app-crashes>What happens when an app crashes<a class=headerlink href=#what-happens-when-an-app-crashes title="Permanent link">&para;</a></h2> <p>In the case that an app becomes unresponsive the process is as follows:</p> <ul> <li>The Gorouter will <a href=https://docs.cloudfoundry.org/concepts/http-routing.html#retry>transparently retry other instances</a>, mark an instance as bad if it cannot make a TCP connection and take the instance out of rotation for 30 seconds</li> <li>The app health check fails</li> <li>The Gorouter is instructed to remove the app from the routing table</li> <li>The app is restarted immediately and <a href="https://docs.cloudfoundry.org/devguide/deploy-apps/healthchecks.html#types:~:text=When%20an%20app%20instance%20fails%2C%20Diego,trying%20to%20restart%20the%20app%20instance.">on restart failure it follows a back-off routine</a>.</li> </ul> <p>In the case that the Gorouter is still able to make a TCP request to an app, for example if a web service is listening, but not able to respond to the request, the Gorouter will continue to send traffic to the instance. To mitigate this it is recommended to to modify the http health check interval below the default of 30 seconds. Depending on the CPU cost of the health check there could be an impact on the platform if the value is set too low.</p> <h2 id=what-happens-when-an-app-stops>What happens when an app stops<a class=headerlink href=#what-happens-when-an-app-stops title="Permanent link">&para;</a></h2> <p>The stop process applies to the following events:</p> <ul> <li><strong>cf push</strong> - old instances of an app are stopped on a rolling basis and replaced by a new version</li> <li><strong>cf restart (rolling strategy)</strong> - old instances of an app are stopped on a rolling basis</li> <li><strong>cf stop</strong> - all instances of the app are stopped</li> <li><strong>Platform scale down</strong> - Diego cells are drained and removed</li> <li><strong>Platform upgrade</strong> - Diego cells follow a rolling replacement</li> </ul> <p>At a very high level the <a href=https://docs.cloudfoundry.org/devguide/deploy-apps/app-lifecycle.html#shutdown>app shutdown process</a> is as follows:</p> <ul> <li>The Gorouter removes the app from its routing table, meaning that no new request will be sent, but outstanding request responses will be honoured</li> <li>The scheduler instructs the Diego cell to stop the app</li> <li>The container is sent the <code>SIGTERM</code> signal, which the app should treat as a soft shutdown event and gracefully complete outstanding requests before stopping cleanly</li> <li>If after 10 seconds the container has not exited, Diego then sends a <code>SIGKILL</code> which will terminate all processes</li> </ul> <p>Should there be the need to extend the time that apps are given to shutdown this can be <a href="https://docs.cloudfoundry.org/devguide/deploy-apps/app-lifecycle.html#shutdown:~:text=containers.graceful_shutdown_interval_in_seconds">set system wide</a> but will have the effect that Diego maintenance events could take longer.</p> <p>Each language will have a different way to respond <code>SIGTERM</code>.</p> <h3 id=java-shutdown>Java shutdown<a class=headerlink href=#java-shutdown title="Permanent link">&para;</a></h3> <p>Java allows the developer to configure <a href=https://docs.oracle.com/javase/7/docs/api/java/lang/Runtime.html#addShutdownHook(java.lang.Thread)>pre-shutdown hooks</a>, to insert logic into the shutdown process.</p> <p>The default behaviour in Java is as follows:</p> <ul> <li>JVM receives <code>SIGTERM</code></li> <li>All <a href=https://docs.oracle.com/javase/7/docs/api/java/lang/Runtime.html#addShutdownHook(java.lang.Thread)>pre-shutdown hooks</a> are triggered (if any are defined)</li> <li>The JVM will then wait for all <a href=https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/lang/Thread.html>non-daemon threads</a> to complete before exiting</li> </ul> <p>The last point is critical, as the JVM will not exit until all theads complete, meaning the app should be designed to take this into account.</p> <h4 id=spring-annotation>Spring annotation<a class=headerlink href=#spring-annotation title="Permanent link">&para;</a></h4> <p>Spring apps can use the <a href=https://www.baeldung.com/spring-postconstruct-predestroy#preDestroy>@pre-destroy</a> annoation to ensure a function is called before exiting.</p> <p>For Java 9+ the following dependency needs to be added.</p> <div class="language-text highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a>&lt;dependency&gt;
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>    &lt;groupId&gt;javax.annotation&lt;/groupId&gt;
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>    &lt;artifactId&gt;javax.annotation-api&lt;/artifactId&gt;
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>    &lt;version&gt;1.3.2&lt;/version&gt;
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a>&lt;/dependency&gt;
</span></code></pre></div> <h3 id=detecting-a-sigkill>Detecting a SIGKILL<a class=headerlink href=#detecting-a-sigkill title="Permanent link">&para;</a></h3> <p>If the following line appears in app logs, then it is proof that an app was forcully shutdown by the system after the app did not respond properly to a <code>SIGTERM</code>.</p> <div class="language-text highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a>OUT Exit status 137 (exceeded 10s graceful shutdown interval)
</span></code></pre></div> <h2 id=testing-app-behaviour>Testing app behaviour<a class=headerlink href=#testing-app-behaviour title="Permanent link">&para;</a></h2> <p>Should an app team need to test the behaviour to ensure the stop and start events are transparent to a client it is recommended to run <code>cf restart --strategy rolling</code> in a dev environment whilst the app is under load. If the app is coded, configured and scaled correctly, then the operation will be invisible to the client.</p> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2024 Matt Proud </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/ladibackware target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg> </a> <a href=https://linkedin.com/in/matt-proud target=_blank rel=noopener title=linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5m282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["navigation.tabs", "navigation.instant", "navigation.tabs.sticky", "content.code.annotate", "content.code.copy", "toc.follow"], "search": "../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../../assets/javascripts/bundle.83f73b43.min.js></script> </body> </html>