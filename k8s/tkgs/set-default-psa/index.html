<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=https://laidbackware.github.io/k8s/tkgs/set-default-psa/ rel=canonical><link href=../admin-access/ rel=prev><link href=../update-cp-disks/ rel=next><link rel=icon href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.5.42"><title>Set default PSA - Matt's Hackery</title><link rel=stylesheet href=../../../assets/stylesheets/main.0253249f.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"JetBrains Mono"}</style><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-F2EF959YF2"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-F2EF959YF2",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-F2EF959YF2",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=cyan data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#set-default-psa-on-vsphere-with-tanzu-126-clusters class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title="Matt's Hackery" class="md-header__button md-logo" aria-label="Matt's Hackery" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Matt's Hackery </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Set default PSA </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/laidbackware/laidbackware.github.io title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> laidbackware/laidbackware.github.io </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../../ci-cd/tanzu-supply-chains/supply-chain-architecture/ class=md-tabs__link> CI/CD </a> </li> <li class=md-tabs__item> <a href=../../../tanzu-platform/intro/ class=md-tabs__link> Tanzu Platform </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../admin-access/ class=md-tabs__link> Kubernetes </a> </li> <li class=md-tabs__item> <a href=../../../shell/bash-recipes/ class=md-tabs__link> Shell </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title="Matt's Hackery" class="md-nav__button md-logo" aria-label="Matt's Hackery" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> Matt's Hackery </label> <div class=md-nav__source> <a href=https://github.com/laidbackware/laidbackware.github.io title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> laidbackware/laidbackware.github.io </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> CI/CD </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> CI/CD </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_1> <label class=md-nav__link for=__nav_2_1 id=__nav_2_1_label tabindex=0> <span class=md-ellipsis> Tanzu Supply Chains </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_1_label aria-expanded=false> <label class=md-nav__title for=__nav_2_1> <span class="md-nav__icon md-icon"></span> Tanzu Supply Chains </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../ci-cd/tanzu-supply-chains/supply-chain-architecture/ class=md-nav__link> <span class=md-ellipsis> Supply chain architecture </span> </a> </li> <li class=md-nav__item> <a href=../../../ci-cd/tanzu-supply-chains/component-architecture/ class=md-nav__link> <span class=md-ellipsis> Component architecture </span> </a> </li> <li class=md-nav__item> <a href=../../../ci-cd/tanzu-supply-chains/hello-component/ class=md-nav__link> <span class=md-ellipsis> Hello Component </span> </a> </li> <li class=md-nav__item> <a href=../../../ci-cd/tanzu-supply-chains/component-authoring-bash/ class=md-nav__link> <span class=md-ellipsis> Component authoring </span> </a> </li> <li class=md-nav__item> <a href=../../../ci-cd/tanzu-supply-chains/private-ca-hack/ class=md-nav__link> <span class=md-ellipsis> Private CA Hack </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Tanzu Platform </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Tanzu Platform </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../tanzu-platform/intro/ class=md-nav__link> <span class=md-ellipsis> Intro </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2> <label class=md-nav__link for=__nav_3_2 id=__nav_3_2_label tabindex=0> <span class=md-ellipsis> Cloud Foundry Runtime </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> Cloud Foundry Runtime </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2_1> <label class=md-nav__link for=__nav_3_2_1 id=__nav_3_2_1_label tabindex=0> <span class=md-ellipsis> App dev </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_2_1_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2_1> <span class="md-nav__icon md-icon"></span> App dev </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../cloud-foundry/app-dev/app-lifecycle/ class=md-nav__link> <span class=md-ellipsis> App Lifecycle Management </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-foundry/app-dev/debugging-traffic/ class=md-nav__link> <span class=md-ellipsis> Debugging egress traffic </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2_2> <label class=md-nav__link for=__nav_3_2_2 id=__nav_3_2_2_label tabindex=0> <span class=md-ellipsis> Bosh </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2_2> <span class="md-nav__icon md-icon"></span> Bosh </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../cloud-foundry/bosh/run-pre-start-commands/ class=md-nav__link> <span class=md-ellipsis> Pre-start script with runtime-config </span> </a> </li> <li class=md-nav__item> <a href=../../../cloud-foundry/bosh/relocating-vms/ class=md-nav__link> <span class=md-ellipsis> Relocate vSphere VMs into another cluster </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2_3> <label class=md-nav__link for=__nav_3_2_3 id=__nav_3_2_3_label tabindex=0> <span class=md-ellipsis> UAA </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2_3> <span class="md-nav__icon md-icon"></span> UAA </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../cloud-foundry/uaa/login/ class=md-nav__link> <span class=md-ellipsis> UAA Login with Golang CLI </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex> <span class=md-ellipsis> Kubernetes </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=true> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_1 checked> <label class=md-nav__link for=__nav_4_1 id=__nav_4_1_label tabindex=0> <span class=md-ellipsis> vSphere with Tanzu (TKGS) </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_1_label aria-expanded=true> <label class=md-nav__title for=__nav_4_1> <span class="md-nav__icon md-icon"></span> vSphere with Tanzu (TKGS) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../admin-access/ class=md-nav__link> <span class=md-ellipsis> Get full admin access </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Set default PSA </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Set default PSA </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#warning class=md-nav__link> <span class=md-ellipsis> Warning </span> </a> </li> <li class=md-nav__item> <a href=#procedure class=md-nav__link> <span class=md-ellipsis> Procedure </span> </a> <nav class=md-nav aria-label=Procedure> <ul class=md-nav__list> <li class=md-nav__item> <a href=#step-1-copy-the-default-clusterclass class=md-nav__link> <span class=md-ellipsis> Step 1 - Copy the default ClusterClass </span> </a> </li> <li class=md-nav__item> <a href=#step-2-modify-the-custom-clusterclass class=md-nav__link> <span class=md-ellipsis> Step 2 - Modify the custom ClusterClass </span> </a> </li> <li class=md-nav__item> <a href=#step-3-apply-the-custom-clusterclass-to-any-namespace class=md-nav__link> <span class=md-ellipsis> Step 3 - Apply the custom ClusterClass to any namespace </span> </a> </li> <li class=md-nav__item> <a href=#step-4-create-clusters-using-the-custom-clusterclass class=md-nav__link> <span class=md-ellipsis> Step 4 - Create clusters using the custom ClusterClass </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../update-cp-disks/ class=md-nav__link> <span class=md-ellipsis> Update the control plane disks </span> </a> </li> <li class=md-nav__item> <a href=../troubleshooting/ class=md-nav__link> <span class=md-ellipsis> Bootstrap Troubleshooting </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2> <label class=md-nav__link for=__nav_4_2 id=__nav_4_2_label tabindex=0> <span class=md-ellipsis> Demo Apps </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_2_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> Demo Apps </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../apps/minimal-lb/ class=md-nav__link> <span class=md-ellipsis> Minimal web app + LB </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Shell </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Shell </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../shell/bash-recipes/ class=md-nav__link> <span class=md-ellipsis> Bash recipes </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#warning class=md-nav__link> <span class=md-ellipsis> Warning </span> </a> </li> <li class=md-nav__item> <a href=#procedure class=md-nav__link> <span class=md-ellipsis> Procedure </span> </a> <nav class=md-nav aria-label=Procedure> <ul class=md-nav__list> <li class=md-nav__item> <a href=#step-1-copy-the-default-clusterclass class=md-nav__link> <span class=md-ellipsis> Step 1 - Copy the default ClusterClass </span> </a> </li> <li class=md-nav__item> <a href=#step-2-modify-the-custom-clusterclass class=md-nav__link> <span class=md-ellipsis> Step 2 - Modify the custom ClusterClass </span> </a> </li> <li class=md-nav__item> <a href=#step-3-apply-the-custom-clusterclass-to-any-namespace class=md-nav__link> <span class=md-ellipsis> Step 3 - Apply the custom ClusterClass to any namespace </span> </a> </li> <li class=md-nav__item> <a href=#step-4-create-clusters-using-the-custom-clusterclass class=md-nav__link> <span class=md-ellipsis> Step 4 - Create clusters using the custom ClusterClass </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=set-default-psa-on-vsphere-with-tanzu-126-clusters>Set default PSA on vSphere with Tanzu 1.26+ clusters<a class=headerlink href=#set-default-psa-on-vsphere-with-tanzu-126-clusters title="Permanent link">&para;</a></h1> <p>From TKR 1.26 and above vSphere with Tanzu changed the default <a href=https://kubernetes.io/docs/concepts/security/pod-security-admission/ >Pod Security Admission</a> (PSA) level to enforced, meaning that each namespace must be labelled to relax the policy. The instructions on this page explain how to create a custom cluster class from the default class which sets the default PSA level to audit.</p> <h2 id=warning>Warning<a class=headerlink href=#warning title="Permanent link">&para;</a></h2> <p>Taken from the vSphere with Tanzu docs.</p> <blockquote> <p>"Custom ClusterClass is an experimental Kubernetes feature per the upstream Cluster API documentation. Due to the range of customizations available with custom ClusterClass, VMware cannot test or validate all possible customizations. Customers are responsible for testing, validating, and troubleshooting their custom ClusterClass clusters. Customers can open support tickets regarding their custom ClusterClass clusters, however, VMware support is limited to a best effort basis only and cannot guarantee resolution to every issue opened for custom ClusterClass clusters. Customers should be aware of these risks before deploying custom ClusterClass clusters in production environments."</p> </blockquote> <p>Given the statement above and the fact that a cluster cannot currently be switched between cluster classes, it is not recommended to use custom cluster classes.</p> <p>The procedure is based on the {vSphere docs](<a href=https://docs.vmware.com/en/VMware-vSphere/8.0/vsphere-with-tanzu-tkg/GUID-EFE7DB40-8748-42B5-9694-DBC21F9FB76A.html>https://docs.vmware.com/en/VMware-vSphere/8.0/vsphere-with-tanzu-tkg/GUID-EFE7DB40-8748-42B5-9694-DBC21F9FB76A.html</a>), which you should always reference to check for changes.</p> <h2 id=procedure>Procedure<a class=headerlink href=#procedure title="Permanent link">&para;</a></h2> <h3 id=step-1-copy-the-default-clusterclass>Step 1 - Copy the default ClusterClass<a class=headerlink href=#step-1-copy-the-default-clusterclass title="Permanent link">&para;</a></h3> <p>Export the variables to match your environment.</p> <div class="language-sh highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nb>export</span><span class=w> </span><span class=nv>NS</span><span class=o>=</span><span class=s2>&quot;ns1&quot;</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=nb>export</span><span class=w> </span><span class=nv>CCC_NAME</span><span class=o>=</span><span class=s2>&quot;my-cc&quot;</span>
</span></code></pre></div> <p>Export the default ClusterClass, strip unnecessary fields and update the name. <div class="language-sh highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a>kubectl<span class=w> </span>-n<span class=w> </span><span class=nv>$NS</span><span class=w> </span>get<span class=w> </span>clusterclass<span class=w> </span>tanzukubernetescluster<span class=w> </span>-o<span class=w> </span>yaml<span class=w> </span>&gt;<span class=w> </span>ccc.yaml
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;/creationTimestamp:/d&#39;</span><span class=w> </span>ccc.yaml<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;/generation:/d&#39;</span><span class=w> </span>ccc.yaml<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=w> </span>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;/resourceVersion:/d&#39;</span><span class=w> </span>ccc.yaml<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;/uid:/d&#39;</span><span class=w> </span>ccc.yaml<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=w> </span>sed<span class=w> </span>-i<span class=w> </span><span class=s1>&#39;/resourceVersion:/d&#39;</span><span class=w> </span>ccc.yaml
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a>sed<span class=w> </span>-i<span class=w> </span><span class=s2>&quot;s/  name: tanzukubernetescluster/  name: </span><span class=si>${</span><span class=nv>CCC_NAME</span><span class=si>}</span><span class=s2>/g&quot;</span><span class=w> </span>ccc.yaml
</span></code></pre></div></p> <h3 id=step-2-modify-the-custom-clusterclass>Step 2 - Modify the custom ClusterClass<a class=headerlink href=#step-2-modify-the-custom-clusterclass title="Permanent link">&para;</a></h3> <p>It's recommended to manually edit the file to set policy, but automated step are listed below.</p> <ul> <li>Open ccc.yaml in your favourity editor.</li> <li>Search for <code>controlPlaneFilesAdmissionConfigurationk8s126</code> and scroll up to see the <code>AdmissionConfiguration</code> template.</li> <li>Modify the yaml to set your policy by updating the section <code>plugins.0.configuration.defaults</code>. Scrolling up 30 lines will show the K8s 1.25 policy which does not enforce.</li> </ul> <h4 id=automated-steps-to-replace-out-the-fields-of-the-k8s-125-policy>Automated steps to replace out the fields of the K8s 1.25 policy.<a class=headerlink href=#automated-steps-to-replace-out-the-fields-of-the-k8s-125-policy title="Permanent link">&para;</a></h4> <p>Use with caution as this was only tested with 1.26.</p> <div class="language-sh highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a>sed<span class=w> </span>-i<span class=w> </span>-E<span class=w> </span><span class=s1>&#39;s/enforce: &quot;restricted&quot;/warn: &quot;restricted&quot;\n                      warn-version: &quot;latest&quot;/&#39;</span><span class=w> </span>ccc.yaml
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>sed<span class=w> </span>-i<span class=w> </span>-E<span class=w> </span><span class=s1>&#39;s/enforce-version: &quot;latest&quot;/audit: &quot;restricted&quot;\n                      audit-version: &quot;latest&quot;/&#39;</span><span class=w> </span>ccc.yaml
</span></code></pre></div> <h3 id=step-3-apply-the-custom-clusterclass-to-any-namespace>Step 3 - Apply the custom ClusterClass to any namespace<a class=headerlink href=#step-3-apply-the-custom-clusterclass-to-any-namespace title="Permanent link">&para;</a></h3> <p>The ClusterClass to any namespaces where it is needed.</p> <div class="language-sh highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=nb>export</span><span class=w> </span><span class=nv>TARGET_NS</span><span class=o>=</span><span class=s2>&quot;ns2&quot;</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a>sed<span class=w> </span>-i<span class=w> </span><span class=s2>&quot;s/namespace: .*/namespace: </span><span class=si>${</span><span class=nv>TARGET_NS</span><span class=si>}</span><span class=s2>/g&quot;</span><span class=w> </span>ccc.yaml
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a>kubectl<span class=w> </span>apply<span class=w> </span>-f<span class=w> </span>ccc.yaml
</span></code></pre></div> <h3 id=step-4-create-clusters-using-the-custom-clusterclass>Step 4 - Create clusters using the custom ClusterClass<a class=headerlink href=#step-4-create-clusters-using-the-custom-clusterclass title="Permanent link">&para;</a></h3> <p>Add the following section to your ClusterClass yamls <div class="language-yaml highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=nt>spec</span><span class=p>:</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=w>  </span><span class=nt>topology</span><span class=p>:</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=w>    </span><span class=nt>class</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">&lt;custom cluster class name&gt;</span>
</span></code></pre></div></p> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2024 Matt Proud </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/ladibackware target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg> </a> <a href=https://linkedin.com/in/matt-proud target=_blank rel=noopener title=linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5m282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["navigation.tabs", "navigation.instant", "navigation.tabs.sticky", "content.code.annotate", "content.code.copy", "toc.follow"], "search": "../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../../assets/javascripts/bundle.83f73b43.min.js></script> </body> </html>